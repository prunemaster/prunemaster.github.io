<!doctype html>
	<meta charset=utf-8>
	<title>select.option</title>

	<style>
		* {font-family:'Segoe UI',sans-serif; white-space:nowrap}
	</style>

	<script>
		function makeSel(n){
			if (!makeSel.areyousure && (n>=(document.styleSheets[0].cssText?5000:15000)) && (makeSel.areyousure=true) &&
				!confirm("Are you sure you want to do this?\n"+n+" options could take a long time.")) return

			btn_clear.disabled= btn_update.disabled= btn_replace.disabled= true
			result.innerHTML="*** busy ***"
			function f(){
				var t0= +new Date().getTime()
				sel.blur()
				sel.selectedIndex= 0
				try{	sel.length= n
				}catch(e){
					// n=10001 firefox throws "NotSupportedError: Operation is not supported"
					result.innerHTML= 'Exception thrown:&nbsp;&nbsp; "'+(e.message||e)+'"'
					btn_clear.disabled= btn_update.disabled= btn_replace.disabled= false
					return
				}
				for (var i=0; i<n; i++){
					sel[i].value= "v"+i
					sel[i].text= "option"+i
				}
				sel.selectedIndex= n-1
				sel.onfocus= function(){
					sel.onfocus= null
					var tf= new Date().getTime()-t0
					result.innerHTML= "result: "+tf+" ms"
					if (tf>=1000)
						result.innerHTML+= "&nbsp;&nbsp; ("+(tf/1000).toFixed(3).replace(/\.000|0*$/," sec)")
					btn_clear.disabled= btn_update.disabled= btn_replace.disabled= false
				}
				sel.focus()
			}
			if (window.requestAnimationFrame)
				requestAnimationFrame(function(){requestAnimationFrame(f)})
			else	setTimeout(f,0)
		}
	</script>

	<p>choose select.length
		<input	id=input value=1
			style=width:10em;margin-left:2em;padding-left:0.5em
			onkeyup="if (event.keyCode=='\r'.charCodeAt(0)) btn_update.click()">
	</p>
	<p>
		<button	id=btn_clear
			style=margin-left:0em
			onclick="makeSel(input.value=1)">
			clear options
		</button>

		<button	id=btn_update
			style=margin-left:2em
			onclick="makeSel(input.value=+input.value.match(/^\s*(\d*)/)[1]||1)">
			update options
		</button>

		<button	id=btn_replace
			style=margin-left:2em
			onclick="sel.parentNode.replaceChild(sel.cloneNode(false),sel)
				sel.length=1
				sel[0].text='new select'
				btn_update.click()">
			replace select
		</button>

		<span	id=result
			style=margin-left:2em>
		</span>
	</p>
	<br>
	<br>
	<select id=sel>
		<option value=v0>option0</option>
	</select>